n = 8;
S = sym('S',[n,n],'real');

for i = 1:n
  for j = i:n
    S(j,i) = S(i,j);
  end
end
disp('starting inverse')
tic
Si = S^-1;
toc
disp('done with inverse')
% save('d8Inv')

r = sym('r',[n,1],'real');
M2 = r'*Si*r;

M2s = simplify(M2);

% M2ss = simplify(M2s);

m2 = matlabFunction(M2s);

save('m28','m2')

m22 = @(r,S)m2(...
  S(1,1,:),S(1,2,:),S(1,3,:),S(1,4,:),S(1,5,:),S(1,6,:),S(1,7,:),S(1,8,:),...
S(2,2,:),S(2,3,:),S(2,4,:),S(2,5,:),S(2,6,:),S(2,7,:),S(2,8,:),...
S(3,3,:),S(3,4,:),S(3,5,:),S(3,6,:),S(3,7,:),S(3,8,:),...
S(4,4,:),S(4,5,:),S(4,6,:),S(4,7,:),S(4,8,:),...
S(5,5,:),S(5,6,:),S(5,7,:),S(5,8,:),...
S(6,6,:),S(6,7,:),S(6,8,:),...
S(7,7,:),S(7,8,:),...
S(8,8,:),...
r(1,:,:),r(2,:,:),r(3,:,:),r(4,:,:),r(5,:,:),r(6,:,:), r(7,:,:),r(8,:,:));